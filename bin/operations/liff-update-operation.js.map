{"version":3,"sources":["../../lib/operations/liff-update-operation.js"],"names":["LIFFUpdateOperation","Operation","usage","sections","header","help","content","code","run","validateConfig","apps","response","listRequest","send","data","error","console","length","log","info","choices","map","app","title","view","type","url","liffId","description","value","prompts","require","name","message","cancelOption","viewTypes","viewType","initial","reduce","init","i","viewUrl","ble","features","active","inactive","updateRequest","row","success","EOL","table","LIFFListRequest","accessToken","config","channel","LIFFUpdateRequest"],"mappings":"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","sourcesContent":["import '../typedef';\n\nimport { Section } from 'command-line-usage';\nimport { EOL } from 'os';\nimport Operation from './operation';\nimport LIFFUpdateRequest from '../apis/liff-update-request';\nimport LIFFListRequest from '../apis/liff-list-request';\n\nexport default class LIFFUpdateOperation extends Operation {\n  static listRequest = new LIFFListRequest({\n    accessToken: this.config.channel.accessToken\n  });\n  static updateRequest = new LIFFUpdateRequest({\n    accessToken: this.config.channel.accessToken\n  });\n\n  static get usage() {\n    /** @type {Section[]} */\n    const sections = [\n      {\n        header: 'Update a LIFF view'.help,\n        content: `liff update`.code\n      }\n    ];\n\n    return sections;\n  }\n\n  static async run() {\n    if (!this.validateConfig()) {\n      return false;\n    }\n\n    let apps = [];\n\n    try {\n      const response = await this.listRequest.send();\n\n      apps = response.data.apps || [];\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n\n    if (!apps.length) {\n      console.log('LIFF app not found'.info);\n      return true;\n    }\n\n    const choices = apps.map(app => {\n      return {\n        title: `${app.view.type} ${app.view.url} [${app.liffId}]`,\n        description: app.description,\n        value: app\n      };\n    });\n\n    const prompts = require('prompts');\n\n    /** @type {{app:LIFFAppData}} */\n    const { app } = await prompts(\n      {\n        type: 'select',\n        name: 'app',\n        message: 'Select a LIFF app to be updated',\n        choices\n      },\n      this.cancelOption\n    );\n\n    if (!app) {\n      return false;\n    }\n\n    const viewTypes = [\n      {\n        title: 'compact',\n        description: '50% of device screen height',\n        value: 'compact'\n      },\n      {\n        title: 'tall',\n        description: '80% of device screen height',\n        value: 'tall'\n      },\n      {\n        title: 'full',\n        description: '100% of device screen height',\n        value: 'full'\n      }\n    ];\n\n    const { viewType } = await prompts(\n      {\n        type: 'select',\n        name: 'viewType',\n        message: 'Select view type',\n        choices: viewTypes,\n        initial: viewTypes.reduce((init, type, i) => {\n          if (type.value === app.view.type) {\n            init = i;\n          }\n          return init;\n        }, 0)\n      },\n      this.cancelOption\n    );\n\n    if (!viewType) {\n      return false;\n    }\n\n    const { viewUrl } = await prompts(\n      {\n        type: 'text',\n        name: 'viewUrl',\n        message: 'View URL',\n        initial: app.view.url\n      },\n      this.cancelOption\n    );\n\n    if (!viewUrl) {\n      return false;\n    }\n\n    const { description } = await prompts(\n      {\n        type: 'text',\n        name: 'description',\n        message: 'View description',\n        initial: app.description\n      },\n      this.cancelOption\n    );\n\n    if (!description) {\n      return false;\n    }\n\n    const { ble } = await prompts(\n      {\n        type: 'toggle',\n        name: 'ble',\n        message:\n          'Is this LIFF app supports BluetoothÂ® Low Energy for LINE Things',\n        initial: app.features && app.features.ble ? true : false,\n        active: 'Yes',\n        inactive: 'No'\n      },\n      this.cancelOption\n    );\n\n    if (typeof ble === 'undefined') {\n      return false;\n    }\n\n    const data = {\n      view: {\n        type: viewType,\n        url: viewUrl\n      },\n      description,\n      features: {\n        ble\n      }\n    };\n\n    try {\n      await this.updateRequest.send(app.liffId, data);\n\n      const row = {};\n\n      row['LIFF app ID'.success] = app.liffId;\n      row['Type'.success] = data.view.type;\n      row['URL'.success] = data.view.url;\n      row['Description'.success] = data.description;\n      row['BLE'.success] =\n        data.features && data.features.ble ? '\\u2713' : '\\u2715';\n\n      console.log(EOL);\n      console.table([row]);\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n\n    return true;\n  }\n}\n"],"file":"liff-update-operation.js"}