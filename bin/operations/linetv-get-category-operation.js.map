{"version":3,"sources":["../../lib/operations/linetv-get-category-operation.js"],"names":["LINETvGetCategoryOperation","Operation","usage","sections","header","help","content","code","validateNonZero","countPerPage","validateCountryCode","countryCode","length","run","validateConfig","prompts","require","channelId","config","channel","id","type","name","message","prompt","validate","cancelOption","categories","listResponse","listRequest","send","data","body","console","log","warn","tabs","map","menu","title","categoryCode","description","categoryName","value","error","page","selectedCategory","choices","initial","getResponse","getRequest","clip","representClip","success","clipNo","clipTitle","serviceUrl","playCount","likeitPoint","table","channels","item","columnHeader","channelName","badgeType","hasMore","nextPage","active","inactive","logAxiosError","info","LINETvListCategoryRequest","accessToken","LINETvGetCategoryRequest"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;AAEe,MAAMA,0BAAN,SAAyCC,kBAAzC,CAAmD;AAQhE,aAAWC,KAAX,GAAmB;AACjB;AACA,UAAMC,QAAQ,GAAG,CACf;AACEC,MAAAA,MAAM,EAAE,2BAA2BC,IADrC;AAEEC,MAAAA,OAAO,EAAG,qBAAD,CAAsBC;AAFjC,KADe,CAAjB;AAOA,WAAOJ,QAAP;AACD;;AAED,SAAOK,eAAP,CAAuBC,YAAvB,EAAqC;AACnC,WAAOA,YAAY,KAAK,CAAjB,GAAqB,qBAArB,GAA6C,IAApD;AACD;;AAED,SAAOC,mBAAP,CAA2BC,WAA3B,EAAwC;AACtC,WAAOA,WAAW,CAACC,MAAZ,KAAuB,CAAvB,GACH,wCADG,GAEH,IAFJ;AAGD;;AAED,eAAaC,GAAb,GAAmB;AACjB,QAAI,CAAC,KAAKC,cAAL,EAAL,EAA4B;AAC1B,aAAO,KAAP;AACD;;AAED,UAAMC,OAAO,GAAGC,OAAO,CAAC,SAAD,CAAvB;;AACA,UAAMC,SAAS,GAAG,KAAKC,MAAL,CAAYC,OAAZ,CAAoBC,EAAtC;AAEA,UAAM;AAAET,MAAAA;AAAF,QACJ,CAAC,MAAMI,OAAO,CACZ;AACEM,MAAAA,IAAI,EAAE,MADR;AAEEC,MAAAA,IAAI,EAAE,aAFR;AAGEC,MAAAA,OAAO,EAAG,gBAAe,aAAaC,MAAO,EAH/C;AAIEC,MAAAA,QAAQ,EAAE,KAAKf;AAJjB,KADY,EAOZ,KAAKgB,YAPO,CAAd,KAQM,EATR;AAWA,QAAIC,UAAU,GAAG,EAAjB;;AAEA,QAAI;AACF,YAAMC,YAAY,GAAG,MAAM,KAAKC,WAAL,CAAiBC,IAAjB,CAAsBb,SAAtB,EAAiCN,WAAjC,CAA3B;;AAEA,UAAI,CAACiB,YAAY,CAACG,IAAd,IAAsBH,YAAY,CAACG,IAAb,CAAkBC,IAAlB,KAA2B,IAArD,EAA2D;AACzDC,QAAAA,OAAO,CAACC,GAAR,CAAY,0BAA0BC,IAAtC;AACA,eAAO,IAAP;AACD;;AAEDR,MAAAA,UAAU,GAAGC,YAAY,CAACG,IAAb,CAAkBC,IAAlB,CAAuBI,IAAvB,GACTR,YAAY,CAACG,IAAb,CAAkBC,IAAlB,CAAuBI,IAAvB,CAA4BC,GAA5B,CAAgCC,IAAI,IAAI;AACtC,eAAO;AACLC,UAAAA,KAAK,EAAED,IAAI,CAACE,YADP;AAELC,UAAAA,WAAW,EAAEH,IAAI,CAACI,YAFb;AAGLC,UAAAA,KAAK,EAAEL;AAHF,SAAP;AAKD,OAND,CADS,GAQT,EARJ;AASD,KAjBD,CAiBE,OAAOM,KAAP,EAAc;AACdX,MAAAA,OAAO,CAACW,KAAR,CAAcA,KAAd;AACA,aAAO,KAAP;AACD;;AAED,QAAI,CAACjB,UAAU,CAACf,MAAhB,EAAwB;AACtBqB,MAAAA,OAAO,CAACC,GAAR,CAAY,cAAcC,IAA1B;AACA,aAAO,IAAP;AACD;;AAED,QAAIU,IAAI,GAAG,CAAX;AACA,UAAM;AAAEC,MAAAA;AAAF,QAAuB,MAAM/B,OAAO,CACxC;AACEM,MAAAA,IAAI,EAAE,QADR;AAEEC,MAAAA,IAAI,EAAE,kBAFR;AAGEC,MAAAA,OAAO,EAAE,mBAHX;AAIEwB,MAAAA,OAAO,EAAEpB;AAJX,KADwC,EAOxC,KAAKD,YAPmC,CAA1C;AAUA,UAAM;AAAEjB,MAAAA;AAAF,QAAmB,MAAMM,OAAO,CACpC;AACEM,MAAAA,IAAI,EAAE,QADR;AAEEC,MAAAA,IAAI,EAAE,cAFR;AAGEC,MAAAA,OAAO,EAAE,6BAHX;AAIEyB,MAAAA,OAAO,EAAE,EAJX;AAKEvB,MAAAA,QAAQ,EAAE,KAAKjB;AALjB,KADoC,EAQpC,KAAKkB,YAR+B,CAAtC;AAWA,QAAIuB,WAAW,GAAG,MAAM,KAAKC,UAAL,CAAgBpB,IAAhB,CACtBb,SADsB,EAEtBN,WAFsB,EAGtBmC,gBAAgB,CAACN,YAHK,EAItBK,IAJsB,EAKtBpC,YALsB,CAAxB;AAOA,UAAM0C,IAAI,GAAGF,WAAW,CAAClB,IAAZ,CAAiBC,IAAjB,CAAsBoB,aAAnC;AACA,UAAMA,aAAa,GAAG,CACpB;AAAE,WAAK,qBAAqBC,OAA5B;AAAqC,YAAMF,IAAI,CAACG;AAAhD,KADoB,EAEpB;AAAE,WAAK,wBAAwBD,OAA/B;AAAwC,YAAMF,IAAI,CAACI;AAAnD,KAFoB,EAGpB;AAAE,WAAK,qBAAqBF,OAA5B;AAAqC,YAAMF,IAAI,CAACK;AAAhD,KAHoB,EAIpB;AAAE,WAAK,aAAaH,OAApB;AAA6B,YAAMF,IAAI,CAACM;AAAxC,KAJoB,EAKpB;AAAE,WAAK,eAAeJ,OAAtB;AAA+B,YAAMF,IAAI,CAACO;AAA1C,KALoB,CAAtB;AAQAzB,IAAAA,OAAO,CAAC0B,KAAR,CAAcP,aAAd;AACAnB,IAAAA,OAAO,CAAC0B,KAAR,CACEV,WAAW,CAAClB,IAAZ,CAAiBC,IAAjB,CAAsB4B,QAAtB,CAA+BvB,GAA/B,CAAmCwB,IAAI,IAAI;AACzC,YAAMC,YAAY,GAAG,EAArB;AACAA,MAAAA,YAAY,CAAC,aAAaT,OAAd,CAAZ,GAAqCQ,IAAI,CAAC5C,SAA1C;AACA6C,MAAAA,YAAY,CAAC,eAAeT,OAAhB,CAAZ,GAAuCQ,IAAI,CAACE,WAA5C;AACAD,MAAAA,YAAY,CAAC,QAAQT,OAAT,CAAZ,GAAgCQ,IAAI,CAACG,SAArC;AACAF,MAAAA,YAAY,CAAC,MAAMT,OAAP,CAAZ,GAA8BQ,IAAI,CAACL,UAAnC;AACA,aAAOM,YAAP;AACD,KAPD,CADF;;AAWA,WAAOb,WAAW,CAAClB,IAAZ,CAAiBC,IAAjB,CAAsBiC,OAA7B,EAAsC;AACpC,YAAM;AAAEC,QAAAA;AAAF,UAAe,MAAMnD,OAAO,CAChC;AACEM,QAAAA,IAAI,EAAE,QADR;AAEEC,QAAAA,IAAI,EAAE,UAFR;AAGEC,QAAAA,OAAO,EAAE,aAHX;AAIEyB,QAAAA,OAAO,EAAE,IAJX;AAKEmB,QAAAA,MAAM,EAAE,KALV;AAMEC,QAAAA,QAAQ,EAAE;AANZ,OADgC,EAShC,KAAK1C,YAT2B,CAAlC;;AAWA,UAAIwC,QAAJ,EAAc;AACZrB,QAAAA,IAAI,GAAGA,IAAI,GAAG,CAAd;;AACA,YAAI;AACFI,UAAAA,WAAW,GAAG,MAAM,KAAKC,UAAL,CAAgBpB,IAAhB,CAClBb,SADkB,EAElBN,WAFkB,EAGlBmC,gBAAgB,CAACN,YAHC,EAIlBK,IAJkB,EAKlBpC,YALkB,CAApB;AAOD,SARD,CAQE,OAAOmC,KAAP,EAAc;AACd,eAAKyB,aAAL,CAAmBzB,KAAnB;AACA,iBAAO,KAAP;AACD;;AACDX,QAAAA,OAAO,CAAC0B,KAAR,CACEV,WAAW,CAAClB,IAAZ,CAAiBC,IAAjB,CAAsB4B,QAAtB,CAA+BvB,GAA/B,CAAmCwB,IAAI,IAAI;AACzC,gBAAMC,YAAY,GAAG,EAArB;AACAA,UAAAA,YAAY,CAAC,aAAaT,OAAd,CAAZ,GAAqCQ,IAAI,CAAC5C,SAA1C;AACA6C,UAAAA,YAAY,CAAC,eAAeT,OAAhB,CAAZ,GAAuCQ,IAAI,CAACE,WAA5C;AACAD,UAAAA,YAAY,CAAC,QAAQT,OAAT,CAAZ,GAAgCQ,IAAI,CAACG,SAArC;AACAF,UAAAA,YAAY,CAAC,MAAMT,OAAP,CAAZ,GAA8BQ,IAAI,CAACL,UAAnC;AACA,iBAAOM,YAAP;AACD,SAPD,CADF;AAUD,OAxBD,MAwBO;AACL,eAAO,IAAP;AACD;AACF;;AACD7B,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAeoC,IAA3B;AACA,WAAO,IAAP;AACD;;AA1K+D;;;;gBAA7CtE,0B,iBACE,IAAIuE,kCAAJ,CAA8B;AACjDC,EAAAA,WAAW,EAFMxE,0BAEJ,CAAKkB,MAAL,CAAYC,OAAZ,CAAoBqD;AADgB,CAA9B,C;;gBADFxE,0B,gBAIC,IAAIyE,iCAAJ,CAA6B;AAC/CD,EAAAA,WAAW,EALMxE,0BAKJ,CAAKkB,MAAL,CAAYC,OAAZ,CAAoBqD;AADc,CAA7B,C","sourcesContent":["import '../typedef';\nimport 'console.table';\nimport { Section } from 'command-line-usage';\nimport Operation from './operation';\nimport LINETvListCategoryRequest from '../apis/linetv-list-catagory-request';\nimport LINETvGetCategoryRequest from '../apis/linetv-get-category-request';\n\nexport default class LINETvGetCategoryOperation extends Operation {\n  static listRequest = new LINETvListCategoryRequest({\n    accessToken: this.config.channel.accessToken\n  });\n  static getRequest = new LINETvGetCategoryRequest({\n    accessToken: this.config.channel.accessToken\n  });\n\n  static get usage() {\n    /** @type {Section[]} */\n    const sections = [\n      {\n        header: 'Gets category home data.'.help,\n        content: `linetv get:category`.code\n      }\n    ];\n\n    return sections;\n  }\n\n  static validateNonZero(countPerPage) {\n    return countPerPage === 0 ? 'Zero is not allowed' : true;\n  }\n\n  static validateCountryCode(countryCode) {\n    return countryCode.length !== 2\n      ? 'Please input ISO 3166-2 (2 characters)'\n      : true;\n  }\n\n  static async run() {\n    if (!this.validateConfig()) {\n      return false;\n    }\n\n    const prompts = require('prompts');\n    const channelId = this.config.channel.id;\n\n    const { countryCode } =\n      (await prompts(\n        {\n          type: 'text',\n          name: 'countryCode',\n          message: `Country Code ${'ISO 3166-2'.prompt}`,\n          validate: this.validateCountryCode\n        },\n        this.cancelOption\n      )) || {};\n\n    let categories = [];\n\n    try {\n      const listResponse = await this.listRequest.send(channelId, countryCode);\n\n      if (!listResponse.data || listResponse.data.body === null) {\n        console.log('Category list not found'.warn);\n        return true;\n      }\n\n      categories = listResponse.data.body.tabs\n        ? listResponse.data.body.tabs.map(menu => {\n            return {\n              title: menu.categoryCode,\n              description: menu.categoryName,\n              value: menu\n            };\n          })\n        : [];\n    } catch (error) {\n      console.error(error);\n      return false;\n    }\n\n    if (!categories.length) {\n      console.log('No category'.warn);\n      return true;\n    }\n\n    let page = 1;\n    const { selectedCategory } = await prompts(\n      {\n        type: 'select',\n        name: 'selectedCategory',\n        message: 'Select a category',\n        choices: categories\n      },\n      this.cancelOption\n    );\n\n    const { countPerPage } = await prompts(\n      {\n        type: 'number',\n        name: 'countPerPage',\n        message: 'Number of display per page?',\n        initial: 10,\n        validate: this.validateNonZero\n      },\n      this.cancelOption\n    );\n\n    let getResponse = await this.getRequest.send(\n      channelId,\n      countryCode,\n      selectedCategory.categoryCode,\n      page,\n      countPerPage\n    );\n    const clip = getResponse.data.body.representClip;\n    const representClip = [\n      { ' ': 'Represent Clip No.'.success, '  ': clip.clipNo },\n      { ' ': 'Represent Clip Title.'.success, '  ': clip.clipTitle },\n      { ' ': 'Represent Clip URL'.success, '  ': clip.serviceUrl },\n      { ' ': 'Play Count'.success, '  ': clip.playCount },\n      { ' ': 'Likeit Count'.success, '  ': clip.likeitPoint }\n    ];\n\n    console.table(representClip);\n    console.table(\n      getResponse.data.body.channels.map(item => {\n        const columnHeader = {};\n        columnHeader['Channel ID'.success] = item.channelId;\n        columnHeader['Channel Name'.success] = item.channelName;\n        columnHeader['Badge'.success] = item.badgeType;\n        columnHeader['URL'.success] = item.serviceUrl;\n        return columnHeader;\n      })\n    );\n\n    while (getResponse.data.body.hasMore) {\n      const { nextPage } = await prompts(\n        {\n          type: 'toggle',\n          name: 'nextPage',\n          message: 'Next Page ?',\n          initial: true,\n          active: 'yes',\n          inactive: 'no'\n        },\n        this.cancelOption\n      );\n      if (nextPage) {\n        page = page + 1;\n        try {\n          getResponse = await this.getRequest.send(\n            channelId,\n            countryCode,\n            selectedCategory.categoryCode,\n            page,\n            countPerPage\n          );\n        } catch (error) {\n          this.logAxiosError(error);\n          return false;\n        }\n        console.table(\n          getResponse.data.body.channels.map(item => {\n            const columnHeader = {};\n            columnHeader['Channel ID'.success] = item.channelId;\n            columnHeader['Channel Name'.success] = item.channelName;\n            columnHeader['Badge'.success] = item.badgeType;\n            columnHeader['URL'.success] = item.serviceUrl;\n            return columnHeader;\n          })\n        );\n      } else {\n        return true;\n      }\n    }\n    console.log('No more page'.info);\n    return true;\n  }\n}\n"],"file":"linetv-get-category-operation.js"}